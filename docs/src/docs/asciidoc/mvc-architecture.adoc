= Application Structure
:doctype: book
:icons: font
:source-highlighter: highlight.js
:toc: left
:toclevels: 3

include::_attributes.adoc[]

[NOTE]
The examples in this guide use the Toolkit DSL.
See link:api-levels.html#toolkit-dsl[Toolkit DSL] for an introduction.

This guide explains how to build maintainable terminal applications using the Model-View-Controller (MVC) pattern with {project-name}.

== Architecture Overview

The recommended architecture separates concerns into three layers:

[source]
----
┌─────────────┐     reads      ┌─────────────┐
│  Controller │ ◄──────────────│    View     │
│   (State)   │                │  (Element)  │
└─────────────┘                └─────────────┘
       ▲                              │
       │         dispatches           │
       └──────────────────────────────┘
                 events
----

* **Controller**: Holds all application state and provides methods to modify it
* **View**: A pure function that reads state from the controller and returns an `Element`
* **Events**: Dispatched to the controller, which updates state

== The Controller

The controller is a plain Java class that encapsulates your application state:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/MvcSnippets.java[tags=todo-controller]
----

=== Controller Design Principles

* **Queries** are pure read-only methods that return state
* **Commands** modify state and have no return value
* Return defensive copies of collections (`List.copyOf()`)
* Keep state private, expose through methods

== The View

The view is a pure function that transforms controller state into UI elements:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/MvcSnippets.java[tags=todo-view]
----

=== View Design Principles

* Views are **pure functions**: `Controller → Element`
* No side effects in render methods
* All state comes from the controller
* Conditional rendering based on controller state

== Event Handling

=== Using Lambda Handlers

For simple applications, attach handlers directly:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/MvcSnippets.java[tags=lambda-handlers]
----

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/MvcSnippets.java[tags=handle-event]
----

=== Separate Key Handler Class

For complex applications, extract event handling:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/MvcSnippets.java[tags=separate-key-handler]
----

=== Event Result

Return values control event propagation:

* `EventResult.HANDLED` - Event was processed, stop propagation
* `EventResult.UNHANDLED` - Event was not processed, continue routing

== Focus Management

=== Making Elements Focusable

Both `id()` AND `focusable()` are required:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/MvcSnippets.java[tags=focusable-elements]
----

=== Focus Navigation

[cols="1,2",options="header"]
|===
|Key |Action

|Tab
|Focus next element

|Shift+Tab
|Focus previous element

|Mouse click
|Focus clicked element

|ESC
|Clear focus (if no element handles it)
|===

=== Multi-Panel Applications

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/MvcSnippets.java[tags=multi-panel]
----

== Dialogs and Overlays

=== The Dialog Element

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/MvcSnippets.java[tags=dialog-element]
----

=== Implementing Custom Overlay

For custom dialogs, implement `Element` directly:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/MvcSnippets.java[tags=custom-overlay]
----

== Complete Example

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/MvcSnippets.java[tags=complete-example]
----

== Benefits of This Architecture

[cols="1,3",options="header"]
|===
|Benefit |Description

|Testable
|Controller can be unit tested without any UI

|Reusable
|Same controller can power different views

|Predictable
|State changes only through controller methods

|Debuggable
|Easy to log/inspect state transitions

|Maintainable
|Clear separation of concerns
|===

== Next Steps

* Explore the link:widgets.html[Widgets Reference] for available components
* Learn about link:bindings.html[Bindings and Actions] for handling user input
* Read the link:developer-guide.html[Developer Guide] for creating custom widgets
* See the link:api-levels.html[API Levels] for alternative approaches
