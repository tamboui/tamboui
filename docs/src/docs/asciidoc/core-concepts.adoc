= Core Concepts
:doctype: book
:icons: font
:source-highlighter: highlight.js
:toc: left
:toclevels: 3

include::_attributes.adoc[]

{project-name}'s architecture follows https://ratatui.rs[ratatui] closely.
If you've used ratatui before, the concepts here will be familiar - `Buffer`, `Cell`, `Frame`, `Widget`, `Layout` all work the same way.

== Rendering Model

{project-name} uses *immediate-mode rendering* with an *intermediate buffer system*:

1. **Widgets render to a Buffer** - not directly to the terminal
2. **Buffer is diffed** - only changed cells are sent to the terminal
3. **Each frame is a full redraw** - simple state management, no retained state in widgets

[source]
----
Application State
       │
       ▼
┌─────────────┐      ┌─────────────┐      ┌─────────────┐
│   Widgets   │ ───▶ │   Buffer    │ ───▶ │  Terminal   │
│   render()  │      │  (diff)     │      │  (output)   │
└─────────────┘      └─────────────┘      └─────────────┘
----

This model makes {project-name} applications easy to reason about: the UI is always a pure function of your application state.

== Buffer System

[TIP]
If you're using the Toolkit DSL, you won't interact with buffers directly. Feel free to skip this section.

=== Buffer

A `Buffer` is a 2D grid of `Cell` objects representing the terminal screen:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=buffer-basics,indent=0]
----

=== Cell

A `Cell` represents a single character with styling:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=cell-basics,indent=0]
----

=== Frame

A `Frame` wraps a buffer and provides rendering helpers:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=frame-basics,indent=0]
----

== Layout System

=== Rect

A `Rect` defines a rectangular region with position and size:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=rect-basics,indent=0]
----

=== Constraints

Constraints define how space is allocated in layouts:

[cols="1,2,2",options="header"]
|===
|Constraint |Description |Example

|`Length(n)`
|Fixed size of n cells
|`Constraint.length(20)`

|`Percentage(n)`
|n% of available space
|`Constraint.percentage(50)`

|`Ratio(num, denom)`
|Fractional size
|`Constraint.ratio(1, 3)`

|`Min(n)`
|At least n cells
|`Constraint.min(10)`

|`Max(n)`
|At most n cells
|`Constraint.max(50)`

|`Fill(weight)`
|Fill remaining space with weight
|`Constraint.fill()` or `Constraint.fill(2)`
|===

=== Layout

A `Layout` divides a rectangular area into smaller areas based on constraints.

The core operation is `split()`: it takes a `Rect` and returns a `List<Rect>` - one for each constraint. You then render widgets into those rectangles.

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=layout-basics,indent=0]
----

Complete example with rendering:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=layout-complete,indent=0]
----

Layouts can be nested:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=layout-nested,indent=0]
----

==== Flex Positioning

When layout children don't fill the entire container (e.g., fixed-size elements in a large space), you can control how remaining space is distributed using `Flex`:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=layout-flex,indent=0]
----

Available flex modes: `START`, `CENTER`, `END`, `SPACE_BETWEEN`, `SPACE_AROUND`, `SPACE_EVENLY`.

See link:styling.html#flex-layout[Flex Layout] in the CSS Styling guide for detailed documentation including CSS usage and practical examples.

=== Direction

Layouts can split in two directions:

* `Direction.VERTICAL` - stack elements top to bottom
* `Direction.HORIZONTAL` - place elements left to right

=== Margin

Add spacing around layouts:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=layout-margin,indent=0]
----

== Styling

=== Style

`Style` is an immutable object that defines text appearance:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=style-basics,indent=0]
----

=== Color

Colors can be specified in multiple ways:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=color-basics,indent=0]
----

=== Modifiers

Text modifiers change how text is displayed:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=modifier-basics,indent=0]
----

== Text System

{project-name} provides a hierarchical text model (`Text` > `Line` > `Span`) for styled terminal output.
For a convenient way to create styled text from markup strings, see link:markup.html[Markup Text].

=== Text

`Text` represents multi-line styled text:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=text-basics,indent=0]
----

=== Line

A `Line` is a single line composed of `Span` objects:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=line-basics,indent=0]
----

=== Span

A `Span` is a styled piece of text:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=span-basics,indent=0]
----

== Widget Interfaces

=== Widget (Stateless)

Stateless widgets implement the `Widget` interface:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=widget-interface,indent=0]
----

Examples: `Paragraph`, `Gauge`, `Block`, `Clear`

=== StatefulWidget (Stateful)

Stateful widgets carry external state:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=stateful-widget-interface,indent=0]
----

The state object tracks selection, scroll position, etc:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=stateful-widget-usage,indent=0]
----

Examples: `ListWidget`, `Table`, `Tabs`, `TextInput`

== Event System

{project-name} supports keyboard, mouse, and tick events:

=== KeyEvent

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=key-event-basics,indent=0]
----

=== MouseEvent

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=mouse-event-basics,indent=0]
----

=== TickEvent

Tick events fire periodically for animations:

[source,java]
----
include::{snippets-dir}/dev/tamboui/docs/snippets/CoreConceptsSnippets.java[tag=tick-event-basics,indent=0]
----

=== Exceptions

TamboUI tries to enforce a clear, consistent exception hierarchy for framework errors.

* All framework exceptions extend `TamboUIException` (`dev.tamboui.error.TamboUIException`). This is a `RuntimeException`.
* Terminal I/O errors are wrapped in `RuntimeIOException` (`dev.tamboui.error.RuntimeIOException`), to avoid having to catch `IOException` which often are non-recoverable.
* Backend (non-I/O) errors use `BackendException` (`dev.tamboui.terminal.BackendException`).
* TUI framework errors use `TuiException` (`dev.tamboui.tui.TuiException`).
* For invalid parameters or state, Java standard exceptions such as `IllegalArgumentException` or `IllegalStateException` are used.
* Domain-specific exception types (e.g., `SolverException` for layout, `CssParseException` for CSS parsing) are used where possible.

TamboUI's `TuiRunner` also provides centralized error handling: all exceptions during rendering and event handling are passed to a configurable `RenderErrorHandler`. The default behavior displays errors (with stack traces) in the UI for easier debugging.

== Next Steps

* Explore the link:widgets.html[Widgets Reference] for available components
* Learn about link:api-levels.html[API Levels] in detail
* Use link:styling.html[CSS Styling] for external style definitions
* Understand link:bindings.html[Bindings and Actions] for input handling
* Build maintainable apps with link:mvc-architecture.html[Application Structure]
